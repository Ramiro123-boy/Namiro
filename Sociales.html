<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Habilidades Sociales - Namiro</title>
  <style>
    :root {
      --primary: #5a189a;
      --primary-600: #6d28d9;
      --primary-700: #5b21b6;
      --primary-800: #3b0a77;
      --bg: #faf9ff;
      --surface: #ffffff;
      --muted: #ede6ff;
      --text: #140e26;
      --text-soft: #2a1b4a;
      --border: rgba(17, 12, 34, 0.12);
      --radius: 12px;
      --shadow: 0 6px 16px rgba(17, 12, 34, 0.12);
      --hero-h: 220px;
    }
    .home-btn { position: fixed; top: 16px; right: 16px; width: 42px; height: 42px; border-radius: 10px; display:flex; align-items:center; justify-content:center; background: var(--surface); color: var(--primary-700); border: 1px solid var(--border); box-shadow: var(--shadow); text-decoration:none; z-index: 2002; }
    .home-btn:hover { filter: brightness(1.03); transform: translateY(-1px); }
    html, body { margin:0; background: var(--bg); color: var(--text); font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; line-height: 1.6; }
    header.hero { position:relative; height: var(--hero-h); background: linear-gradient(90deg, var(--primary-800), var(--primary-600)); color:#fff; display:flex; align-items:center; overflow:hidden; }
    header.hero .wrap { width:100%; max-width: 980px; margin: 0 auto; padding: 16px; }
    header.hero h1 { margin:0 0 6px 0; }
    header.hero p { margin:0; opacity:1; color:#fff; }
    header.hero .top-bar { position:absolute; top:0; left:0; right:0; background:#ffffff; color: var(--primary-700); font-weight:900; padding:10px 14px; }
    header.hero .bottom-fade { position:absolute; left:0; right:0; bottom:0; height:52%; background: linear-gradient(to top, color-mix(in srgb, var(--primary-600) 26%, #ffffff) 0%, rgba(255,255,255,.8) 60%, transparent 100%); }
    .container { max-width: 980px; margin: 16px auto 32px; padding: 16px; background: var(--surface); border: 1px solid var(--border); border-radius: 16px; box-shadow: var(--shadow); }
    .top-actions { display:flex; gap: 8px; justify-content: space-between; align-items:center; margin-bottom: 12px; }
    .btn { background: var(--primary-600); color: #fff; border:none; border-radius: 10px; padding: 10px 16px; cursor:pointer; box-shadow: 0 8px 18px rgba(17,12,34,.18); }
    .btn:hover { filter: brightness(1.08); transform: translateY(-1px); }
    .text-soft { color: var(--text-soft); }
    .actions { display:grid; grid-template-columns: 1fr 1fr; gap:0; margin-top: 12px; }
    .actions .btn { width:100%; border-radius:0; }
    .actions .btn:first-child { border-top-left-radius:10px; border-bottom-left-radius:10px; }
    .actions .btn:last-child { border-top-right-radius:10px; border-bottom-right-radius:10px; }
    /* Levels */
    .levels-head { margin: 6px 0 12px; }
    .levels-grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 14px; }
    .level-card { perspective: 1000px; }
    .level-card .inner { position: relative; width: 100%; height: 180px; transition: transform .6s; transform-style: preserve-3d; }
    .level-card.flipped .inner { transform: rotateY(180deg); }
    .level-card .face { position:absolute; inset:0; backface-visibility: hidden; border-radius: 12px; display:flex; align-items:center; justify-content:center; text-align:center; padding: 14px; }
    .level-card .front { background: var(--surface); border: 1px solid var(--border); box-shadow: var(--shadow), inset 0 0 0 2px var(--primary-600), inset 0 0 0 6px var(--surface), inset 0 0 0 10px var(--primary-600); color: var(--primary-700); }
    .level-card .front .icon { width: 46px; height: 46px; border-radius: 50%; display:flex; align-items:center; justify-content:center; background: linear-gradient(135deg, var(--primary-600), var(--primary)); color:#fff; box-shadow: 0 6px 16px rgba(17,12,34,.2); }
    .level-card .front .icon svg { width: 26px; height: 26px; }
    .level-card .back { background: var(--muted); border: 1px solid var(--border); transform: rotateY(180deg); color: var(--text); }
    .level-card .status { position:absolute; top:8px; right:8px; font-size: 11px; font-weight:700; background: color-mix(in srgb, var(--primary-600) 16%, transparent); color: var(--primary-700); padding: 4px 6px; border-radius: 6px; }
    .level-card.locked { filter: grayscale(0.6) opacity(0.75); }
    .level-card.locked .front { cursor: not-allowed; }
    .level-card.current .front { cursor: pointer; }
    .footer-note { margin-top: 10px; font-size: 13px; color: var(--text-soft); }
    footer { max-width: 980px; margin: 0 auto 24px; color: var(--text-soft); font-size: 13px; text-align:center; }

    [data-theme="dark"] { --bg: #0f0a1a; --surface: #171022; --muted: #1f1530; --text: #ece8f5; --text-soft: #cfc4e8; --border: rgba(236, 232, 245, 0.12); --shadow: 0 8px 20px rgba(0,0,0,.35); --primary: #7c3aed; --primary-600: #7c3aed; --primary-700: #6d28d9; --primary-800: #4c1d95; }
    [data-theme="dark"] header.hero .top-bar { background:#1f1b2a; color:#e5e7eb; }
    [data-theme="dark"] header.hero .bottom-fade { background: linear-gradient(to top, color-mix(in srgb, var(--primary-600) 40%, #0f0a1a) 0%, rgba(15,10,26,.82) 60%, transparent 100%); }
  </style>
  <script>
    // optional: apply saved theme
    (function(){
      try {
        const s = JSON.parse(localStorage.getItem('app_settings')||'{}');
        if(s.theme === 'dark') document.documentElement.setAttribute('data-theme','dark');
      } catch(e){}
    })();
  </script>
</head>
<body>
  <a href="Inicio.html" class="home-btn" aria-label="Volver a selección de juegos" title="Inicio">
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7"/><path d="M9 22V12h6v10"/></svg>
  </a>
  <header class="hero">
    <div class="top-bar">Habilidades social</div>
    <div class="wrap">
      <h1>Habilidades Social</h1>
      <p>Reto de 6 días: abre una carta diaria y cumple la misión para mejorar tus habilidades sociales.</p>
    </div>
    
  </header>

  <main class="container">
    <section id="intro">
      <h2 style="margin:0 0 6px 0; color: var(--primary-700)">Habilidades Social</h2>
      <p class="text-soft" style="margin:0 0 10px 0">Recuerda: sé respetuoso y cuida tu seguridad en cada interacción.</p>
      <div class="actions">
        <button id="btnPlay" class="btn">Jugar</button>
        <a class="btn" href="Inicio.html">Regresar</a>
      </div>
    </section>

    <section id="levelsSection" class="levels" style="display:none;">
      <div class="levels-head">
        <h2 style="margin:0 0 6px 0; color: var(--primary-700)">Cartas del reto</h2>
        <p id="levelsInfo" class="text-soft" style="margin:0">Abre una carta cada 24 horas. Las cartas desbloqueadas quedan visibles para revisarlas cuando quieras.</p>
      </div>
      <div id="levelsGrid" class="levels-grid"></div>
      <div id="levelsHint" class="footer-note">Abre una carta cada 24 horas.</div>
    </section>
  </main>

  <footer>
    Namiro — Habilidades Social
  </footer>

  <script>
    const SOCIAL_KEY = 'social_levels_state';
    const MISSIONS = [
      'Día 1: Sal a la calle y di “Buenos días” a una persona.',
      'Día 2: Repite el saludo con al menos 3 personas distintas.',
      'Día 3: Ve a un comercio y compra algo sencillo.',
      'Día 4: Inicia una breve charla (2-3 frases) con un conocido.',
      'Día 5: Ve a un parque y preséntate a alguien nuevo.',
      'Día 6: Entabla una conversación con alguien al azar en la calle.'
    ];

    function nowMs(){ return Date.now(); }
    function loadState(){
      try{
        const session = localStorage.getItem('session');
        if(session){
          let users = {};
          try { users = JSON.parse(localStorage.getItem('users_db')||'{}'); } catch(e) { users = {}; }
          const prog = users[session] && users[session].progress && users[session].progress.social;
          if(prog){
            const idx = Number.isFinite(prog.index)? prog.index : 0;
            const last = Number.isFinite(prog.lastCompletedAt)? prog.lastCompletedAt : 0;
            return { index: Math.max(0, Math.min(6, idx)), lastCompletedAt: last };
          }
          // Session exists but no progress yet: start fresh
          return { index:0, lastCompletedAt:0 };
        }
      }catch(e){}
      // No session: fall back to legacy shared key
      try {
        const s = JSON.parse(localStorage.getItem(SOCIAL_KEY)||'{}');
        const idx = Number.isFinite(s.index)? s.index : 0;
        const last = Number.isFinite(s.lastCompletedAt)? s.lastCompletedAt : 0;
        return { index: Math.max(0, Math.min(6, idx)), lastCompletedAt: last };
      } catch(e){ return { index:0, lastCompletedAt:0 }; }
    }
    function saveState(st){
      try{
        const session = localStorage.getItem('session');
        if(session){
          let users = {};
          try { users = JSON.parse(localStorage.getItem('users_db')||'{}'); } catch(e) { users = {}; }
          users[session] = users[session] || {};
          users[session].progress = users[session].progress || {};
          users[session].progress.social = { index: st.index||0, lastCompletedAt: st.lastCompletedAt||0 };
          // Mirror to communication progress used by Inicio.html progress bar
          const idx = Number(st.index||0);
          const commLevel = idx >= 6 ? 2 : (idx > 0 ? 1 : 0);
          users[session].progress.communication = { level: commLevel, pct: Math.round((commLevel/2)*100) };
          localStorage.setItem('users_db', JSON.stringify(users));
        } else {
          // Legacy only when no session
          localStorage.setItem(SOCIAL_KEY, JSON.stringify(st));
        }
      }catch(e){}
    }
    function canOpen(st){
      if(st.index>=6) return false;
      if(!st.lastCompletedAt) return true;
      return (nowMs() - st.lastCompletedAt) >= 24*60*60*1000; // 24 hours
    }
    function msToHH(mm){ const h=Math.floor(mm/3600000), m=Math.floor((mm%3600000)/60000); return `${h}h ${m}m`; }

    const grid = document.getElementById('levelsGrid');
    const hint = document.getElementById('levelsHint');
    const intro = document.getElementById('intro');
    const levelsSection = document.getElementById('levelsSection');
    const btnPlay = document.getElementById('btnPlay');

    function render(){
      const st = loadState();
      grid.innerHTML = '';
      const allowed = canOpen(st);
      for(let i=0;i<6;i++){
        const card = document.createElement('div');
        card.className = 'level-card'+(i<st.index? ' completed flipped':'')+(i===st.index? (allowed?' current':' locked'):'')+(i>st.index? ' locked':'');
        const inner = document.createElement('div'); inner.className='inner';
        const front = document.createElement('div'); front.className='face front';
        const back = document.createElement('div'); back.className='face back';

        const wrap = document.createElement('div');
        const icon = document.createElement('div'); icon.className='icon'; icon.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a4 4 0 0 1-4 4H8l-4 4v-8a4 4 0 0 1 4-4h9a4 4 0 0 1 4 4z"/></svg>';
        const lbl = document.createElement('div'); lbl.style.marginTop='10px'; lbl.style.fontWeight='800'; lbl.style.color='var(--primary-700)'; lbl.textContent = `Nivel ${i+1}`;
        wrap.appendChild(icon); wrap.appendChild(lbl); front.appendChild(wrap);

        const status = document.createElement('div'); status.className='status';
        status.textContent = (i<st.index)? 'Completado' : (i===st.index? (allowed? 'Disponible':'Bloqueado') : 'Bloqueado');
        front.appendChild(status);

        back.innerHTML = `<div style="font-weight:600;">${MISSIONS[i]}</div>`;

        inner.appendChild(front); inner.appendChild(back); card.appendChild(inner);

        if(i===st.index && allowed){
          front.addEventListener('click', ()=>{
            card.classList.add('flipped');
            const ns = loadState();
            ns.index = Math.min(6, (ns.index||0)+1);
            ns.lastCompletedAt = nowMs();
            saveState(ns);
            setTimeout(render, 350);
          });
        }
        grid.appendChild(card);
      }
      const st2 = loadState();
      if(st2.index>=6){ hint.textContent = '¡Completaste los 6 niveles!'; }
      else if(!canOpen(st2)){
        const remaining = (24*60*60*1000) - (nowMs() - st2.lastCompletedAt);
        hint.textContent = `Nueva carta disponible en ${msToHH(Math.max(0, remaining))}.`;
      } else {
        hint.textContent = 'Abre una carta cada 24 horas.';
      }
    }

    btnPlay.addEventListener('click', ()=>{
      intro.style.display = 'none';
      levelsSection.style.display = '';
      render();
    });

    // Auto-open levels if arriving with ?play=1
    (function(){
      const params = new URLSearchParams(window.location.search);
      if(params.get('play') === '1'){
        intro.style.display = 'none';
        levelsSection.style.display = '';
        render();
      }
    })();
  </script>
 </body>
</html>
